---
mainfont: serif;
execute:
  echo: false
  warning: false
  freeze: true
---

```{r}
library(dplyr)
library(ggplot2)
library(haven)
library(sf)
library(vctrs)
library(base)
library(tidycensus)
library(tigris)
library(gdata)
library(scales)
library(spatialreg)
library(spdep)
library(rlist)
library(gdata)
library(tidyr)
library(stringr)
library(raster)
library(FedData)
library(rasterVis)
library(raster)
library(sp)
library(rgdal)
library(reshape2)
library(treemapify)
library(ggplot2)
library(kableExtra)
library(animation)
library(scales)
library(ggplot2)
library(maptools)
library(maps)
library(cowplot)
library(FedData)
library(rasterVis)
library(readxl)
library(ggpattern)
library(scales)
```

## Introduction

Air pollution's adverse impact on respiratory health is a widely known issue. The World Health Organization acknowledged the significance of this risk factor in its 68th conference, where they note that "exposure to air pollutants, including fine particulate matter, is a leading risk factor for noncommunicable diseases in adults, including ischaemic heart disease, stroke, chronic obstructive pulmonary disease, asthma and cancer, and poses a considerable health threat to current and future generations," [-@worldhealthassembly2015]. Further, numerous studies have substantiated the risk that air pollution poses to population health, many linking air pollution to industrial areas and urbanization. On the other hand, other research recognize the variable impacts of interactions between urban built environments, air pollution, and health. This group of research considers factors ranging from the built environment's impact on promoting walking and other forms of exercise, to the impact of exercising in areas with high levels of air pollution, and to the role that urban greenspace plays in reducing air pollution [@hankey2012], [@lee2022],[@alcock2017]. The study of air pollution's impact of respiratory health is complicated by the interactions between the natural environment, built environment, and human behavior. Therefore, approaching the problem using spatial methods may reveal prevailing patterns that result from the exchanges between all factors. This paper attempts to create a spatial model that predicts respiratory health patterns using air pollution and land cover data in the United States. By incorporating land cover data, I attempt to consider human interactions with the natural and built environment, and its impact on respiratory health, through direct or indirect means.

Associations between land use and health impacts have also been studied in the past, with varying findings. Wang and colleagues found a negative correlation between Chronic Obstructive Pulmonary Disease (COPD) mortality and land use mix in most neighborhoods in China's Jing'an district except for northwest areas. In northwest neighborhoods, COPD mortality was positively correlated with land use mix [@wang2019 pp.7]. Other studies, such as Alcock and colleagues' analysis of asthma hospitalizations in the UK, find that increases in urban green space and tree density are associated with reductions in asthma hospitalizations [@alcock2017,pp.39]. However, models that included air pollutant exposure variables complicated this correlation [@alcock2017,pp.39]. Another study that analyzes variation in spatial distribution of lung cancer incidence rates in Shanghai, China found that industrial parks and urban-rural mixed areas show higher risk of lung cancer [@wang2022, pp.13]. Wang and colleagues also postulate that high lung cancer rates in high-density urban areas away from industrial pollution exposures may be due to traffic and other pollutants [-@wang2022, pp.13].

The complex results of past studies underscore the symbiotic nature of human interactions with the built environment, and the downstream implications on individuals' health status. Wang and colleagues explained the changes in relationship between land use mix and COPD mortality by linking the existence of arterial roadways, which may increase opportunities for generation of air pollutants and negatively impact health, to their use to improve access to care [-@wang2019]. The shift in balance between the two factors, they say, is why results varied in highly urban areas as compared to highly rural regions [@wang2019, pp. 8]. Kim and colleagues also address the dichotomy of the urban environment's impact on traffic, air pollution and behavior by considering walkability and land use diversity in their model of the association between the built environment and asthma in Los Angeles, California [-@kim2023]. Their model builds upon urban planning ideas that mixed-use land reduces motorized travel through promotion of ride-sharing, walking, and shortened distances to destinations, while also promoting better physical through dedicated open spaces and recreational areas [@kim2023, pp. 58]. One limitation of Kim and colleagues' model is the limited spatial scope. In this paper, I build upon elements of Kim and colleagues' model but incorporate other scale considerations.

Scale considerations are a challenge in all spatial analyses, therefore it is not surprising that scale is listed as limitation listed in most spatial analyses of land use, pollution, and respiratory health. Huang and colleagues address the modifiable areal unit problem (MAUP) by analyzing the impacts of land use data at different buffer sizes to determine trends across different spatial units [-@huang2021]. They also select data from different regions that are representative of different environments and climates to determine if regional factors influence their air pollution models [@huang2021]. Their results suggest that land cover types have varying significance across spatial scales, concluding that air pollutant levels are primarily affected by regional land cover types [@huang2021, pp. 7]. This paper builds upon their approach by acknowledging the role that climate plays in air pollution distribution, proliferation, and mitigation. Separating U.S. land areas based on climate region will acknowledge the spillover effects of air pollution that may not be appropriately captured in analyses performed at local scales [@simon2015].

This research uses U.S. age-adjusted mortality rates from respiratory diseases (defined as ICD-10 codes J00 - J98) as the respiratory health indicator. In Mueller and colleagues' literature analysis on greenspace and respiratory health research, they found that respiratory mortality had the most consistent positive evidence as compared to research measuring other health indicators, including asthma, lung function, hospital admissions, among other measures [@mueller2022, pp. 28]. Using mortality rates from cardiovascular and respiratory diseases will capture acute and chronic conditions that can be impacted by instances of severe drops in air quality and more moderate yet sustained air quality issues.

## Relationship Between Health and Place

One reason why it is difficult to prove a causal relationship between environmental risk factors such as air pollution and a health outcome is because health outcomes can be cumulative results of a combination of factors. When considering air pollution's impact on health, one such factor are air pollution's exposure pathways. Exposure can vary depending on distance from sources of pollution and the amount of time spent breathing in pollutants, both of which can fluctuate when considering climate, ventilation, time spent outdoors, among other factors. Arguably the simplest way to measure exposure is by measuring proximity to pollutant sources. However, spatial analysis of epidemiological phenomena should consider more than just geographic location. This is because an individual's activity spaces are not simply a feature of that person, but a reflection of a myriad of influences that result in an individuals' choice to frequent those spaces. Entwisle highlights this topic in *Putting People into Place,* arguing that there is a critical need to "incorporate agency in theories of neighborhood and health," [@entwisle2007, pp. 699]. Entwisle identifies the symbiotic relationship between individuals' opportunities, social interactions, BLAH that inform decisions to move to or remain in a space, and how that informs health decisions. She also acknowledges that individuals can influence their communities. Bernard and colleagues build on this notion by formalizing a conceptualization of neighborhoods. Their framework identifies four primary influences on access to health-related resources: "proximity, rights, prices, and informal reciprocity," [@bernard2007, pp. 1849]. WRAP ABOUT HOW THIS RELATES.

This research acknowledges the role that individual decisions play in informing their activity spaces by including demographic and quality of life variables. The inclusion of these variables help to contextualize individuals within each county. These variables range from race to income, education, access to care, and health behaviors. By including demographic and quality of life variables, the model attempts to characterize those occupying the spaces, account for factors that influence interactions with health related resources, and acknowledge the role of positive and negative health behaviors on mortality risk.

The fact that this research fails to acknowledge the role that individuals' play in influencing their localities is a shortcoming that can be addressed in future iterations of this model. Local communities are constantly being reshaped in large and small ways. Agency over change in space (use the vocabulary that Browning uses) can be evaluated by reviewing changes in localities over time. In this research, individual influence over their communities may manifest in improvements to regulations to reduce industrial air pollution, improvement to ventilation systems, and increases in indoor recreation alternatives, to name a few examples. Such interventions could lower community exposure to air pollution and potentially reduce adverse health impacts. A future enhancement to this model would incorporate variables over a longer time horizon to measure sensitivity of mortality rates to changes in localities over time.

## Data and Methods

Data fall into four major categories: health, demographic, air pollution, and land use. However, since this is a spatial analysis, the common thread in all data sources is the spatial linkage. Spatial evaluation of air pollution's impact on health is considered on a regional level. Following the approach that Simon and colleagues take to evaluate ozone trends in the U.S., this analysis also uses NOAA climate regions in the analysis of air pollution [-@simon2015]. Evaluation of data on a regional scale lowers the model's sensitivity to factors such as wind, climate, and pollutants' chemical reactions with other molecules in the air that can cause the concentration of air pollution to change [@simon2015, pp 186, pp. 188]. To this end, four regions were selected for this research, which represent different climate areas and a wide variety of land cover types.

```{r}
#| fig-width: 15
#| fig-height: 10
#| fig-cap: Figure 1; Annual summary of air quality metrics by monitoring site from 2014 - 2016

readRenviron("~/.Renviron") ## my census api key thru PSU census_api_key("eaaf0e3dde825849338015707f07974203e9ae94",install = TRUE, overwrite = TRUE)

#v20<- load_variables(2020, "acs5", cache = TRUE)

#export to csv #write.csv(v20, file = "R/outputs/var.csv")
options(tigris_use_cache = TRUE)

acs <- get_acs(geography = "county" ,
               variables = c(tot_pop = "B01001_001" , 
                             tot_wht = "B02001_002" , 
                             tot_blk = "B02001_003" , 
                             tot_his = "B03001_003" , 
                             tot_pov = "B17001_002"),
              year = 2016,
              geometry = TRUE)#income in past 12 mos below poverty level ,year =2016 ,geometry = TRUE)

#load air quality data
#airQ_14 <- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/annual_conc_by_monitor_2014_v1.csv', header = TRUE, sep = ",", fill=TRUE)
airQ_15_PM <- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/annual_conc_by_monitor_2015_v1.csv', header = TRUE, sep = ",", fill=TRUE)
airQ_15_O <- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/annual_conc_by_monitor_2015_v2.csv', header = TRUE, sep = ",", fill=TRUE)
#airQ_16 <- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/annual_conc_by_monitor_2016_v1.csv', header = TRUE, sep = ",", fill=TRUE)
airQ_all <- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/annual_conc_by_monitor_3yr.csv', header = TRUE, sep = ",", fill=TRUE)
airQ_county <- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/conreport2015.csv', header = TRUE, sep = ",", fill=TRUE)
airQ_county_m <- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/PM25 Monitored and Modeled 2015.csv', header = TRUE, sep = ",", fill=TRUE)

# Code Climate Regions by state per NOAA
NE <- c('09','10','11','23','24','25','33','36','42','44','50','34')
NR <- c('30','31','38','46','56') #Northern Rockies and Plains
W <- c('06','32')
UM <-c('19','26','27','55') #Upper Midwest
S <- c('05','20','22','28','40','48') 
OV <- c('17','18','21','29','39','47','54') #Ohio Valley
SE <- c('01','12','13','37','45','51')
SW <-c('04','08','35','49')
NW <-c('16','41','53')
non_US <-c('02','15','60','66','69','72','78') #outside of continental US

#turn this into a data table
STATEFP<-c('09','10','11','23','24','25','33','36','42','44','50','34','30','31','38','46','56','06','32','19','26','27','55','05','20','22','28','40','48','17','18','21','29','39','47','54','01','12','13','37','45','51','04','08','35','49','16','41','53','02','15','60','66','69','72','78')
reg_names<-c('NE','NE','NE','NE','NE','NE','NE','NE','NE','NE','NE','NE','NR','NR','NR','NR','NR','W','W','UM','UM','UM','UM','S','S','S','S','S','S','OV','OV','OV','OV','OV','OV','OV','SE','SE','SE','SE','SE','SE','SW','SW','SW','SW','NW','NW','NW','non_US','non_US','non_US','non_US','non_US','non_US','non_US')

regions<-data.frame(STATEFP,reg_names)

#State Outlines for when we map the results...
options(tigris_class = "sf")
sts<- tigris::states(cb=F, year = 2015)
sts<- st_boundary(sts)%>%
  st_transform(crs = 2163)%>%
  filter(!STATEFP%in%non_US)

# #plot data airq 2015
# AirQ_plot1<-ggplot(acs)+geom_sf(data=sts, color="black")+
#   geom_point(data=airQ_15_PM,
#              aes(x = Longitude, y = Latitude),
#              fill = "transparent",
#              colour = "black",
#              size = .75)+
#   geom_point(data = airQ_15_PM,
#              aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
#               size = 0.25)+
#   scale_color_gradient(low = "blue", 
#                        high = "red",
#                        name = 'Mean PM 2.5 Lvl')+
#   ggtitle("Annual Avg: PM2.5 Levels by Monitor", subtitle = "U.S. EPA, 2015")
# 
# #plot data airq 2015 Daily 8 hour avg ozone reading
# AirQ_plot2<-ggplot(acs)+geom_sf(data=sts, color="black")+
#   geom_point(data=airQ_15_O,
#              aes(x = Longitude, y = Latitude),
#              fill = "transparent",
#              colour = "black",
#              size = .75)+
#   geom_point(data = airQ_15_O,
#              aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
#              size = 0.25)+
#   scale_color_gradient(low = "blue", 
#                        high = "red",
#                        name = 'Mean Ozone')+
#   ggtitle("Annual Avg: Daily 8-Hour Avg Ozone", subtitle = "U.S. EPA, 2015")
# 
# #print together
# cowplot::plot_grid(AirQ_plot1, AirQ_plot2)
```

This research focuses on particulate matter (PM) 2.5 measures from 2015, as captured by the Environmental Protection Agency (EPA) and further manipulated by the Centers for Disease Control and Prevention (CDC). PM 2.5 are "fine, inhalable particles with diameters that are generally 2.5 micrometers or smaller," that have been linked to various complications with lung and heart functions [@usepa2016]. The EPA publishes extensive amounts of air quality data, which are accessible through their Air Data website. Available data include annual summaries by monitor.

Figure 1 plots the 2015 annual PM 2.5 measures on region-dependent scales by NOAA Climate region to provide a geographic reference for monitor locations and start to visually represent the variation in PM 2.5 measurements by region. The entire contiguous U.S. is represented in Figure 1, but it is worth noting that only the Northwest, West, Ohio Valley, and Southeast NOAA Climate Regions were selected for this study. These regions were selected due to their climatic variation, regional air quality variation, and either high presence or decent distribution of air quality monitors. A visual inspection of Figure 1 reveals how monitors are distributed throughout each region and their individual readings. It is noted that though the West region has a relative abundance of monitors in California, monitors are sparse in Nevada. This observation leads to the acknowledgement of potential spatial bias: monitors are not normally distributed throughout space, therefore spatial bias may be introduced due to the distribution of data across the measurement areas. However, the level of spatial bias difficult to measure due to the use of the CDC's modeled data.

```{r}
#| fig-width: 10
#| fig-height: 8
#| fig-cap: Figure 2; Average Annual PM 2.5 by region. Regional P.M 2.5 levels plotted on different scales.

#add leading zeroes to state and county
airQ_vec_c <- airQ_15_PM%>% pull(County.Code)
co_vec_airQ <-sprintf("%02d",as.numeric(airQ_vec_c))
airQ_vec_s <- airQ_15_PM%>% pull(State.Code)
st_vec_airQ <-sprintf("%02d",as.numeric(airQ_vec_s))

airQ_prep1 <-cbind(st_vec_airQ,co_vec_airQ,airQ_15_PM)
airQ_prep2 <-airQ_prep1[,-c(3,4)]

#start prepping for region plots
sts_NE<- sts%>%filter(STATEFP%in%NE) #exclude those outside of continental US

#plot data airq 2015
NE_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%NE)

NE_plot<-ggplot(acs)+geom_sf(data=sts_NE, color="black")+
  geom_point(data=NE_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = NE_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: Northeast", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_NR<- sts%>%filter(STATEFP%in%NR) #exclude those outside of continental US

#plot data airq 2015
NR_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%NR)

NR_plot<-ggplot(acs)+geom_sf(data=sts_NR, color="black")+
  geom_point(data=NR_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = NR_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: Northern Rockies", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_W<- sts%>%filter(STATEFP%in%W) #exclude those outside of continental US

#plot data airq 2015
W_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%W)

W_plot<-ggplot(acs)+geom_sf(data=sts_W, color="black")+
  geom_point(data=W_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = W_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: West", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_UM<- sts%>%filter(STATEFP%in%UM) #exclude those outside of continental US

#plot data airq 2015
UM_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%UM)

UM_plot<-ggplot(acs)+geom_sf(data=sts_UM, color="black")+
  geom_point(data=UM_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = UM_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: Upper Midwest", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_OV<- sts%>%filter(STATEFP%in%OV) #exclude those outside of continental US

#plot data airq 2015
OV_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%OV)

OV_plot<-ggplot(acs)+geom_sf(data=sts_OV, color="black")+
  geom_point(data=OV_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = OV_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: Ohio Valley", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_S<- sts%>%filter(STATEFP%in%S) #exclude those outside of continental US

#plot data airq 2015
S_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%S)

S_plot<-ggplot(acs)+geom_sf(data=sts_S, color="black")+
  geom_point(data=S_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = S_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: South", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_SE<- sts%>%filter(STATEFP%in%SE) #exclude those outside of continental US

#plot data airq 2015
SE_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%SE)

SE_plot<-ggplot(acs)+geom_sf(data=sts_SE, color="black")+
  geom_point(data=SE_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = SE_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: Southeast", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_SW<- sts%>%filter(STATEFP%in%SW) #exclude those outside of continental US

#plot data airq 2015
SW_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%SW)

SW_plot<-ggplot(acs)+geom_sf(data=sts_SW, color="black")+
  geom_point(data=SW_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = SW_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: Southwest", subtitle = "U.S. EPA, 2015")

#start prepping for region plots
sts_NW<- sts%>%filter(STATEFP%in%NW) #exclude those outside of continental US

#plot data airq 2015
NW_dat<-airQ_prep2%>%
  filter(st_vec_airQ%in%NW)

NW_plot<-ggplot(acs)+geom_sf(data=sts_NW, color="black")+
  geom_point(data=NW_dat,
             aes(x = Longitude, y = Latitude),
             fill = "transparent",
             colour = "black",
             size = 1.5)+
  geom_point(data = NW_dat,
             aes(x = Longitude, y = Latitude, colour = Arithmetic.Mean),
             size = 1)+
  scale_color_gradient(low = "yellow", high = "navy", name = 'PM2.5')+
  labs(x=NULL, y=NULL) +
  guides(x="none",y="none") +
  ggtitle("Air Quality: Northwest", subtitle = "U.S. EPA, 2015")

#map all 2015 Air Quality data
cowplot::plot_grid(NW_plot, NR_plot, NE_plot, W_plot, SW_plot, UM_plot, OV_plot, S_plot, SE_plot)

```

The CDC provides measured and modeled PM 2.5 data by county for the U.S., as depicted in Figure 2. They derive their data from daily PM 2.5 measurements produced by the EPA, then further model to infer measurements for areas where there are gaps in the data. Derivations are primarily based on the Downscaler (DS) model, which is "a statistical fusion of monitoring data and Community Multiscale Air Quality (CMAQ) outputs," \[\@geograph\]. While use of this data is convenient, a future iteration of this research will produce and employ a PM 2.5 inference model, which would be produced specifically for this research. Doing so would control for any unknowns that are introduced due to the limitations of using modeled data that is not easily reproducible.

One limitation of the air quality data used in this model is the use of annually summarized data. While useful, annual summaries may not be sensitive enough to capture acute changes in air quality, which pose a health risk (CITE?). This relationship may not be captured in the model if poor air quality days are infrequent enough to impact the mean. For simplicity, this research does not take seasonality into consideration and instead uses annual averages, which does not accurately reflect variation in air pollution ranges.

```{r}
#| fig-width: 10
#| fig-height: 6
#| fig-cap: Figure 3; County-level air pollution statistics. Region selection limited by availability of data

#split cofips to two columns
acs_dat <-acs %>%
  pivot_wider(names_from = "variable", values_from = c("estimate", "moe"))%>%
  rename(cofips = GEOID)%>%
  transform(STATEFP = substr(cofips, 1, 2))%>%
  filter(!STATEFP%in%non_US) #exclude those outside of continental US

#load mortality data
AAMR_all <- read.table('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/All Underlying Cause Mortality Rates Ade Adjusted 2014 thru 2016.txt',header = TRUE, sep = "\t", fill=TRUE)
AAMR_ICDI_all <- read.table('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/Card Resp Mortality Rates Age Adjusted All Ages.txt',header = TRUE, sep = "\t", fill=TRUE)
AAMR_ICDI_65 <- read.table('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/Card Resp Mortality Rates Age Adjusted 65+.txt',header = TRUE, sep = "\t", fill=TRUE)


CDC_data_prep1 <- full_join(AAMR_all,AAMR_ICDI_all, by = "County.Code")
CDC_data_prep2 <-full_join(CDC_data_prep1,AAMR_ICDI_65,by="County.Code")
CDC_data_prep3 <-CDC_data_prep2 %>%
  rename(cofips = County.Code)

#add leading zeros to CDC data county FIPs codes
cofips_vec <- CDC_data_prep3 %>% pull(cofips)
cofips_vec_new <-sprintf("%05d",as.numeric(cofips_vec))
CDC_data_prep4 <-cbind(cofips_vec_new,CDC_data_prep3)

#clean up columns
CDC_data_prep5 <-CDC_data_prep4[,c(1,3,7,8,13,14,19,20)]%>%
  rename(AAMR_all_crude = Crude.Rate.x
         , AAMR_all_aa = Age.Adjusted.Rate.x
         , AAMR_ICDI_crude = Crude.Rate.y
         , AAMR_ICDI_aa = Age.Adjusted.Rate.y
         , AAMR_ICDI65_crude = Crude.Rate
         , AAMR_ICDI65_aa = Age.Adjusted.Rate
         , cofips = cofips_vec_new)


#1/15/23 prelim merges so I can eval data
merge1 <-left_join(acs_dat,CDC_data_prep5, by = "cofips")

merge2 <- merge1 %>%
  mutate(across(c(AAMR_all_crude:AAMR_ICDI65_aa), na_if, 'Unreliable'))

cols <-c("AAMR_all_aa","AAMR_ICDI_aa","AAMR_ICDI65_aa")

merge3 <- merge2 %>%
  mutate_at(cols,as.numeric)


#replace NAs with mean
is.na_replace_mean1 <- merge3$AAMR_all_aa      # Duplicate first column
x_num_mean1 <- as.numeric(mean(is.na_replace_mean1, na.rm = TRUE))        # Calculate mean
is.na_replace_mean1[is.na(is.na_replace_mean1)] <- x_num_mean1

is.na_replace_mean2 <- merge3$AAMR_ICDI_aa      # Duplicate first column
x_num_mean2 <- as.numeric(mean(is.na_replace_mean2, na.rm = TRUE))        # Calculate mean
is.na_replace_mean2[is.na(is.na_replace_mean2)] <- x_num_mean2

is.na_replace_mean3 <- merge3$AAMR_ICDI65_aa                           # Duplicate first column
x_num_mean3 <- as.numeric(mean(is.na_replace_mean3, na.rm = TRUE))        # Calculate mean
is.na_replace_mean3[is.na(is.na_replace_mean3)] <- x_num_mean3

#merge with data table
prep1 <- cbind(merge3,is.na_replace_mean1, is.na_replace_mean2, is.na_replace_mean3)

#prep county airQ data; add leading zeroes to state and county
airQ_vec_c <- airQ_county_m%>% pull(cofips)
co_vec_airQ <-sprintf("%05d",as.numeric(airQ_vec_c))
airQ_vec_s <- airQ_county_m%>% pull(State)
st_vec_airQ <-sprintf("%02d",as.numeric(airQ_vec_s))

airQ_c_prep1 <-cbind(co_vec_airQ,st_vec_airQ,airQ_county_m)
airQ_c_prep2 <-airQ_c_prep1[,-c(3,5)]%>%
  rename(cofips=co_vec_airQ)

#join to the rest of county level data
c_prep1 <- left_join(prep1,airQ_c_prep2, by="cofips")
c_prep2 <- subset(c_prep1,select = -c(8:12,14,24:27))%>%
  rename(PM2.5=Value)

#map pollution indicators

#State Outlines for when we map the results...
options(tigris_class = "sf")
sts<- tigris::states(cb=T, year = 2016 )
sts<- st_boundary(sts)%>%
  st_transform(crs = 2163)%>%
  filter(!STATEFP%in%non_US) #exclude those outside of continental US

c_prep2%>%
  mutate(PM= cut(PM2.5, breaks=quantile(PM2.5, p=seq(0,1,length.out = 6), na.rm=T), include.lowest=T ))%>%
  ggplot()+geom_sf(aes(fill=PM,color=NA))+
  scale_color_brewer("Blues")+
  scale_fill_brewer(palette = "Blues", na.value="grey50")+
  geom_sf(data=sts, color="black")+
  ggtitle("Monitored & Modeled PM 2.5 Levels by County", subtitle = "CDC National Environmental Public Health Tracking Data, 2015")


# #prep county airQ data; add leading zeroes to state and county
# airQ_vec_c <- airQ_county%>% pull(County.Code)
# co_vec_airQ <-sprintf("%05d",as.numeric(airQ_vec_c))
# 
# 
# airQ_c_prep1 <-cbind(co_vec_airQ,airQ_county)
# airQ_c_prep2 <-airQ_c_prep1[,-c(2)]%>%
#   rename(cofips=co_vec_airQ)%>%
#   mutate(across(c(CO.2nd.Max.1.hr:Lead.Max.3.Mo.Avg), na_if, '.'))
# 
# #convert target col values from character to numeric
# cols.num <- c("PM2.5.Weighted.Mean.24.hr","Ozone.2nd.Max.1.hr")
# airQ_c_prep2[cols.num] <- sapply(airQ_c_prep2[cols.num],as.numeric)
# 
# #join to the rest of county level data
# c_prep1 <- left_join(prep1,airQ_c_prep2, by="cofips")
# c_prep2 <- subset(c_prep1,select = -c(8:12,14,24))
# 
# #map pollution indicators
# 
# #State Outlines for when we map the results...
# options(tigris_class = "sf")
# sts<- tigris::states(cb=T, year = 2016 )
# sts<- st_boundary(sts)%>%
#   st_transform(crs = 2163)%>%
#   filter(!STATEFP%in%non_US) #exclude those outside of continental US
# 
# airQ_c_plot1 <-c_prep2%>%
#   mutate(PM= cut(PM2.5.Weighted.Mean.24.hr, breaks=quantile(PM2.5.Weighted.Mean.24.hr, p=seq(0,1,length.out = 6), na.rm=T), include.lowest=T ))%>%
#   ggplot()+geom_sf(aes(fill=PM,color=NA))+
#   scale_color_brewer("Blues")+
#   scale_fill_brewer(palette = "Blues", na.value="grey50")+
#   geom_sf(data=sts, color="black")+
#   ggtitle("24 hour average PM 2.5 Levels by County", subtitle = "US EPA, 2015")
# 
# airQ_c_plot2 <-c_prep2%>%
#   mutate(Ozone= cut(Ozone.2nd.Max.1.hr, breaks=quantile(Ozone.2nd.Max.1.hr, p=seq(0,1,length.out = 4), na.rm=T), include.lowest=T ))%>%
#   ggplot()+geom_sf(aes(fill=Ozone,color=NA))+
#   scale_color_brewer("Blues")+
#   scale_fill_brewer(palette = "Blues", na.value="grey50")+
#   geom_sf(data=sts, color="black")+
#   ggtitle("1-hour second max Ozone Levels by County", subtitle = "US EPA, 2015")
# 
# #map all 2015 Air Quality data
# cowplot::plot_grid(airQ_c_plot1, airQ_c_plot2)
```

Respiratory health is measured by age-adjusted mortality rates by county, accessed through the Center for Disease Control and Prevention's (CDC) WONDER database. The first data set extracted is all-age, all-cause age-adjusted mortality rate by county for the three-year period from 2014 through 2016. Data were further filtered based on primary reported cause of death based on the ICD-10 code range I00-I99, which encompasses cardiovascular diseases and J00-J98, respiratory diseases [@cdcwond]. Previous research exposing correlations between air pollution and mortality have focused on the same set of diagnostic codes [@oneill2008], [@wong2008]. One limitation of data on the primary cause of death is that health can be influenced by a variety of issues. When there are multiple causes of death, those multiple causes are noted but for this purpose, only the primary cause is used to characterize the cardiovascular or respiratory disease-related death population. Therefore, the data would be missing those who had respiratory illnesses as a contributing factor but not the primary cause. It would be interesting to better analyze this population to see if there are trends that would support the inclusion of respiratory disease as a cause of death (and not just the primary cause), but for this research, honing in on the primary cause of death should be sufficient. Another limitation is that the diagnostic classes used in this model are broad. It is an intentional choice to cast a wide net on mortality causes because air pollution's impact on individual health can manifest in a variety of ways. However, the shortcoming of this tactic is that it introduces more data that may potentially be unrelated to air pollution. This is something to be mindful of when reviewing the results of data modeling.

```{r}
#plot mortality data

#plot data 2
prep1%>%
  mutate(AAMR= cut(AAMR_all_aa , breaks=quantile(AAMR_all_aa, p=seq(0,1,length.out = 6), na.rm=T ), include.lowest=T ))%>%
  ggplot()+geom_sf(aes(fill=AAMR,color=NA))+
  scale_colour_viridis_d()+
  scale_fill_viridis_d(option = "magma",direction = -1, na.value="grey50")+
  scale_y_continuous(label=scales::comma)+
  geom_sf(data=sts, color="black")+
  ggtitle("Age-Adjusted Mortality Rate", subtitle = "Rates per 100,000; CDC, 2014 - 2016")

#plot data 3
prep1%>%
  mutate(AAMR_ICDI= cut(AAMR_ICDI_aa, breaks=quantile(AAMR_ICDI_aa, p=seq(0,1,length.out = 6), na.rm=T ), include.lowest=T ))%>%
  ggplot()+geom_sf(aes(fill=AAMR_ICDI,color=NA))+
  scale_colour_viridis_d()+
  scale_fill_viridis_d(direction = -1, na.value="grey50")+
  scale_y_continuous(label=scales::comma)+
  geom_sf(data=sts, color="black")+
  ggtitle("Age-Adjusted Mortality Rates - Cardiovascular & Respiratory Diseases", subtitle = "Rates per 100,000; CDC, 2014 - 2016")

#plot data 4
prep1%>%
  mutate(AAMR_ICDI_65= cut(AAMR_ICDI65_aa, breaks=quantile(AAMR_ICDI65_aa, p=seq(0,1,length.out = 6), na.rm=T ), include.lowest=T ))%>%
  ggplot()+geom_sf(aes(fill=AAMR_ICDI_65,color=NA))+
  scale_colour_viridis_d()+
  scale_fill_viridis_d(direction = -1, na.value="grey50")+
  scale_y_continuous(label=scales::comma)+
  geom_sf(data=sts, color="black")+
  ggtitle("Age-Adjusted Mortality Rates 65+: Cardiovascular & Respiratory Diseases", subtitle = "Rates per 100,000; CDC, 2014 - 2016")
```

To further characterize county populations, demographic and behavioral data are consulted. Data on age-adjusted adult smoking rates by county are extracted from the University of Wisconsin Public Health Institute's County Health Rankings. This data is consulted to normalize out any distortions caused by smoking habits by county. However, prevalence rates do not capture the severity of tobacco use by individual. Severity of smoking habits are not considered in this model. County Health Rankings source for its smoking data is the CDC's Behavioral Risk Factor Surveillance System (BRFSS) [@adultsm]. One limitation to the BRFSS is that data is collected from surveys, then extrapolated to characterize county-level summaries. The conduction of surveys and extrapolation process leave room for error so is noted for transparency. TALK ABOUT MORE VARIABLES USED FORM COUNTY HEALTH RANKINGS. Demographic data are obtained from the U.S. Census Bureau's American Community Survey (ACS). 5-year rates for the survey ended in 2016 are used in this model. CURRENTLY TARGETING THESE VARIABLES: Percent poverty, percent Black, percent Hispanic, urbanization are used in this model. ACS data are obtained through the Census API, accessed through R Studio.

Land cover data used in this model are originally sourced from the National Land Cover Database's (NLCD). The International Public Use Microdata Series (IPUMS) released county-level summaries of NLCD land cover data, which are displayed in the ensuing plots. Per IPUMS' annotations on methodology, NLCD data were layered with census geographic polygons to calculate the area covered by each land class [@environm]. Land cover classifications are determined by NLCD using a modified Anderson Land Cover Classification System [@national]. A description of NLCD's land cover classifications are denoted in the data table below. Data used in this model reflect 2011 land cover data summarized by county geographic boundaries in the U.S. Census Bureau's 2015 data set.

![NLCD Land Cover Types](land%20cover%20types.png){width="666"}

```{r}
#load NLCD download
#NLCD<-raster::raster('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/nlcd_2019_land_cover_l48_20210604.img')
NLCD_15<- read.csv('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/US_county_2015_nlcd_2011_v1.csv', header = TRUE, sep = ",", fill=TRUE)

#add leading zeroes
NLCD_vec_c <- NLCD_15%>%
  pull(cofips)
co_vec_NLCD <-sprintf("%05d",as.numeric(NLCD_vec_c))

NLCD_prep1 <-cbind(co_vec_NLCD,NLCD_15)
NLCD_prep2 <-NLCD_prep1[,-c(2,3,4,5)]

#remove all but the proportion columns - need to fix rename
NLCD_prep3 <-NLCD_prep2[,-c(2:19)]%>%
  rename(cofips=co_vec_NLCD)

#merge to our running file
c_prep3<-left_join(c_prep2, NLCD_prep3, by = "cofips")
c_prep3<-left_join(c_prep3,regions, by= "STATEFP")

#filter on target regions only
c_prep4<-c_prep3%>%
  filter(reg_names%in%c("W","SE","OV","NW"))

# load the NLCD legend from FedData package
legend<-pal_nlcd()
variable<-paste("PROP",legend$ID,sep="")
legend_box<-cbind(legend,variable)

#reshape for box plots
W_box1<-subset(c_prep4,select=c(1:2,20:37))%>%
  filter(reg_names%in%c("W"))

#careful of reshape2 warning
W_box2<-reshape2::melt(W_box1,id.vars=c('cofips','NAME','reg_names'),measure.vars=c('PROP11','PROP12','PROP21','PROP22','PROP23','PROP24','PROP31','PROP41','PROP42','PROP43','PROP52','PROP71','PROP81','PROP82','PROP90','PROP95'))

#final touches
W_box3<-left_join(W_box2,legend_box,by="variable")

############REPEAT FOR SECOND REGION################
#reshape for box plots
SE_box1<-subset(c_prep4,select=c(1:2,20:37))%>%
  filter(reg_names%in%c("SE"))

#careful of reshape2 warning
SE_box2<-reshape2::melt(SE_box1,id.vars=c('cofips','NAME','reg_names'),measure.vars=c('PROP11','PROP12','PROP21','PROP22','PROP23','PROP24','PROP31','PROP41','PROP42','PROP43','PROP52','PROP71','PROP81','PROP82','PROP90','PROP95'))

#final touches
SE_box3<-left_join(SE_box2,legend_box,by="variable")

############REPEAT FOR THIRD REGION################
#reshape for box plots
OV_box1<-subset(c_prep4,select=c(1:2,20:37))%>%
  filter(reg_names%in%c("OV"))

#careful of reshape2 warning
OV_box2<-reshape2::melt(OV_box1,id.vars=c('cofips','NAME','reg_names'),measure.vars=c('PROP11','PROP12','PROP21','PROP22','PROP23','PROP24','PROP31','PROP41','PROP42','PROP43','PROP52','PROP71','PROP81','PROP82','PROP90','PROP95'))

#final touches
OV_box3<-left_join(OV_box2,legend_box,by="variable")

############REPEAT FOR FOURTH REGION################
#reshape for box plots
NW_box1<-subset(c_prep4,select=c(1:2,20:37))%>%
  filter(reg_names%in%c("NW"))

#careful of reshape2 warning
NW_box2<-reshape2::melt(NW_box1,id.vars=c('cofips','NAME','reg_names'),measure.vars=c('PROP11','PROP12','PROP21','PROP22','PROP23','PROP24','PROP31','PROP41','PROP42','PROP43','PROP52','PROP71','PROP81','PROP82','PROP90','PROP95'))

#final touches
NW_box3<-left_join(NW_box2,legend_box,by="variable")

###########PLOT ALL BOXES###############
#plot West Box Plot
ggplot(W_box3, aes(x = variable, y = value, fill = Class)) +    # Create boxplot chart in ggplot2
  geom_boxplot() +
  labs(x="",y="Percent of County Total") +
  guides(x="none") +
  ggtitle("Land Cover Histogram: Counties in NOAA West Region", subtitle = "NLCD 2019")

#plot Southeast Box Plot
ggplot(SE_box3, aes(x = variable, y = value, fill = Class)) +    # Create boxplot chart in ggplot2
  geom_boxplot() +
  labs(x="",y="Percent of County Total") +
  guides(x="none") +
  ggtitle("Land Cover Histogram: Counties in NOAA Southeast Region", subtitle = "NLCD 2019")

#plot Ohio Valley Box Plot
ggplot(OV_box3, aes(x = variable, y = value, fill = Class)) +    # Create boxplot chart in ggplot2
  geom_boxplot() +
  labs(x="",y="Percent of County Total") +
  guides(x="none") +
  ggtitle("Land Cover Histogram: Counties in NOAA Ohio Valley Region", subtitle = "NLCD 2019")

#plot Northwest Box Plot
ggplot(NW_box3, aes(x = variable, y = value, fill = Class)) +    # Create boxplot chart in ggplot2
  geom_boxplot() +
  labs(x="",y="Percent of County Total") +
  guides(x="none") +
  ggtitle("Land Cover Histogram: Counties in NOAA Northwest Region", subtitle = "NLCD 2019")

#box plot target variable 1
ggplot(c_prep4, aes(x = reg_names, y = PROP21, fill = reg_names)) +    # Create boxplot chart in ggplot2
  geom_boxplot()+
  labs(x="",y="Percent of County Total") +
  ggtitle("Land Cover Histogram: Developed, Open Space", subtitle = "NLCD 2019")

#box plot target variable 2
ggplot(c_prep4, aes(x = reg_names, y = PROP22, fill = reg_names)) +    # Create boxplot chart in ggplot2
  geom_boxplot()+
  labs(x="",y="Percent of County Total") +
  ggtitle("Land Cover Histogram: Developed, Low Intensity", subtitle = "NLCD 2019")

#box plot target variable 3
ggplot(c_prep4, aes(x = reg_names, y = PROP23, fill = reg_names)) +    # Create boxplot chart in ggplot2
  geom_boxplot()+
  labs(x="",y="Percent of County Total") +
  ggtitle("Land Cover Histogram: Developed, Medium Intensity", subtitle = "NLCD 2019")

#box plot target variable 4
ggplot(c_prep4, aes(x = reg_names, y = PROP24, fill = reg_names)) +    # Create boxplot chart in ggplot2
  geom_boxplot()+
  labs(x="",y="Percent of County Total") +
  ggtitle("Land Cover Histogram: Developed, High Intensity", subtitle = "NLCD 2019")
  
# sts_proj <- projectRaster(sts,crs=crs(NLCD))
# 
# e_sts_W <- as(extent(sts_W),'SpatialPolygons')
# crs(e_sts_W) <- crs(NLCD)
#NLCD_w <- crop(NLCD,e_sts_W, mask = T)
#
#resample(NLCD,sts_W)
# 
# myKey <- list(rectangles=list(col = legend$Color),
#              text=list(lab=legend$Class),
#              space='left',
#              columns=1,
#              size=2,
#              cex=.6)
# 
# 
# # load in map and locality data
# library(FedData)
# NLCD_W <-get_nlcd(
#   template = sts_W,
#   label = "West",
#   year = 2016,
#   dataset = c("landcover"),
#   landmass = "L48",
#   force.redo = TRUE
#   )
# 
# rasterVis::levelplot(NLCD_W,
#           col.regions=legend$Color,
#           par.settings = list(axis.line = list(col = "transparent"), 
#                strip.background = list(col = 'transparent'), 
#                strip.border = list(col = 'transparent')), 
#           scales = list(col = "transparent"),
#           colorkey=F,
#           key=myKey)
# 
# # #calculate frequency over region... need to do this over counties
# # f <- freq(NLCD_W)
# # f <- data.frame(f)
# # f$area <- round(f$count * 900 / 1e6, 1)
# # levs <- levels(NLCD_W)[[1]]
# # f$class <- levs[f$value + 1]
# # 
# # f_W<-f%>%
# #   rename(ID = value)%>%
# #   left_join(f, legend, by="ID")
# # # sum(f$area)
# 
# #load in map and locality data
# NLCD_OV <-get_nlcd(
#   template = sts_OV,
#   label = "Ohio Valley Region",
#   year = 2016,
#   dataset = c("landcover"),
#   landmass = "L48",
#   force.redo = TRUE
#   )
# 
# rasterVis::levelplot(NLCD_OV,
#           col.regions=legend$Color,
#           par.settings = list(axis.line = list(col = "transparent"), 
#                strip.background = list(col = 'transparent'), 
#                strip.border = list(col = 'transparent')), 
#           scales = list(col = "transparent"),
#           colorkey=F,
#           key=myKey)
# 
# # #load in map and locality data
# # NLCD_S <-get_nlcd(
# #   template = sts_S,
# #   label = "South",
# #   year = 2016,
# #   dataset = c("landcover"),
# #   landmass = "L48",
# #   force.redo = TRUE
# #   )
# # 
# # rasterVis::levelplot(NLCD_S,
# #           col.regions=legend$Color,
# #           par.settings = list(axis.line = list(col = "transparent"), 
# #                strip.background = list(col = 'transparent'), 
# #                strip.border = list(col = 'transparent')), 
# #           scales = list(col = "transparent"),
# #           colorkey=F,
# #           key=myKey)
# 
# #load in map and locality data
# NLCD_SE <-get_nlcd(
#   template = sts_SE,
#   label = "Southeast",
#   year = 2016,
#   dataset = c("landcover"),
#   landmass = "L48",
#   force.redo = TRUE
#   )
# 
# rasterVis::levelplot(NLCD_SE,
#           col.regions=legend$Color,
#           par.settings = list(axis.line = list(col = "transparent"), 
#                strip.background = list(col = 'transparent'), 
#                strip.border = list(col = 'transparent')), 
#           scales = list(col = "transparent"),
#           colorkey=F,
#           key=myKey)
# 
# # #load in map and locality data
# # NLCD_NW <-get_nlcd(
# #   template = sts_NW,
# #   label = "Northwest",
# #   year = 2016,
# #   dataset = c("landcover"),
# #   landmass = "L48",
# #   force.redo = TRUE
# #   )
# # 
# # rasterVis::levelplot(NLCD_NW,
# #           col.regions=legend$Color,
# #           par.settings = list(axis.line = list(col = "transparent"), 
# #                strip.background = list(col = 'transparent'), 
# #                strip.border = list(col = 'transparent')), 
# #           scales = list(col = "transparent"),
# #           colorkey=F,
# #           key=myKey)
# 
# #trying to estimate raster values by county
# #find data source for map by county
# county_W <-counties(state = W, cb = TRUE, resolution = "500k", year = 2016,keep_zipped_shapefile=TRUE)
# 
#filter on NOAA region - West... did not work due to size
#
# (class.counts <- lapply(e_W, table))
# (class.prop <- lapply(e_W, FUN = function(x) {prop.table(table(x))}))

# Table of areas in km^2 -not working. delete?
# NLCD_OV_tbl <-
#   NLCD_OV %>%
#   values() %>%
#   tibble::tibble(landcover = .) %>%
#   na.omit() %>%
#   dplyr::group_by(landcover) %>%
#   count(name = "freq") %>%
#   dplyr::mutate(area = (freq * 900) %>%
#                   units::set_units("m^2") %>%
#                   units::set_units("km^2"))

```

This research uses regression modeling on three NOAA climate regions to test if creating models for each region produces significant results. The region-based modeling using NOAA's climatically consistent region definitions draws from research on by Simon and colleagues. Simon and colleagues justify their use of NOAA climate regions by acknowledging that ozone patterns are partially determined by temperature and precipitation [-@simon2015, pp. 188]. Additionally, they note that climate regions generally group areas with similar emissions types and similar trends in temporal variation due to daylight and season [@simon2015, pp. 188]. By modeling for each region, I attempt to normalize out some of the variation due to climate, seasonality, and emissions type which should remove some noise from the models.

Data are first approximated at a county level. Air quality data is captured by monitors, whose locations are indicated in the EPA's data files. In order to spread air quality metrics over space, spatial interpolation is used (add specifications). Land cover data is also approximated at the county level by using R to quantify the area of major land cover types that are measured in each county.REMOVE?

The dependent variable that is being used as a proxy for health is age-adjusted mortality rate for respiratory diseases. After a review of the dependent and independent variables, OLS regression models are consulted. The OLS regression model will estimate the effect of the independent variables on the dependent variable. Different combinations of variables are tested to evaluate what creates the best model, and results are evaluated for statistical significance.

A linear regression model is then evaluated for spatial autocorrelation. The regression model depends on independence and heteroskedasticity of residuals. If spatial autocorrelation is present, then both rules are broken. Spatial autocorrelation is tested using the Global Moran's I test, followed by mapping the Local Moran's I. Spatial clustering is revealed by the Local Indicator of Spatial Association (LISA) map. The Lagrange Multiplier test is consulted to determine if spatial error or spatial lag is driving spatial autocorrelation in the model. Based on the Lagrange Multiplier results, the spatial \[lag/error\] model is used to try to produce a better model.

```{r}
#prep data
health_c <- read_excel('C:/Users/tamas/OneDrive/Documents/APDEM 808/data files/2016 county health v3.xlsx')

c_prep3<-left_join(c_prep2,health_c, by="cofips")
c_prep3<-subset(c_prep3,select=-c(20:21))
                
```

------------------------------------------------------------------------
